<html>
<head>
<title>JS Draw!</title>
</head>
<body>
<!-- TODO center the canvas does not work yet -->
<!-- <canvas id="myCanvas" width="1000" height="750" style="background-color: grey; margin-left=auto; margin-right=auto; display=block;"/> -->
<canvas id="myCanvas" width="1000" height="500" style="background-color: grey;" />
<script>
// util functions
function rand_int(start, end) {
  start = Math.floor(start);
  end = Math.floor(end);
  if (start >= end) {
    console.log(`Invalid input to rand_int: start ${start}, end ${end}`);
    return start;
  }
  width = end - start;
  return Math.floor((Math.random() * width) + start);
}

function http_get_params() {
  params = {}
  for (var assignstr of location.href.split('?')[1].split('&')) {
    pair = assignstr.split('=')
    key = decodeURIComponent(pair[0])
    val = decodeURIComponent(pair[1])
    params[key] = val;
  }
  return params
}

function draw_pixel(ctx, x, y) {
  ctx.beginPath()
  ctx.moveTo(x, y)
  ctx.lineTo(x + 1, y + 1);
  ctx.stroke();
}

function reset_canvas(canvas, ctx) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

</script>
<script>
function draw_rect_demo(ctx) {
  ctx.fillStyle = "#00ff00";
  ctx.fillRect(0, 0, 20, 40);
}

function draw_circle_demo(canvas, ctx) {
  reset_canvas(canvas, ctx);
  num_circle = rand_int(5, 11);
  color_list = ["#ff0000", "#00ff00", "#0000ff"];
  for (var circ_id = 0; circ_id < num_circle; ++circ_id) {
    x = rand_int(0, canvas.width)
    y = rand_int(0, canvas.height)
    radius = rand_int(20, 50)
    color = color_list[rand_int(0, color_list.length)];
    ctx.fillStyle = color;
    ctx.beginPath()
    ctx.arc(x, y, radius, 0, 3.14 * 2);
    ctx.fill()
  }
  setTimeout(function() { draw_circle_demo(canvas, ctx);}, 1000);
}

// y = yscale * sin(x / xscale)
function draw_sin(canvas, ctx, shift=0) {
  reset_canvas(canvas, ctx);
  orig_x = 10
  orig_y = canvas.height / 2
  xscale = 20
  yscale = -20

  for (var x = 0; x < canvas.width - 10; ++x) {
    var y = yscale * Math.sin((x + shift) / xscale);
    ctx.strokeStyle = "#ff0000"
    draw_pixel(ctx, x + orig_x, y + orig_y)
    ctx.strokeStyle = "#00ff00"
    draw_pixel(ctx, x + orig_x, -y + orig_y)
  }
  setTimeout(function() { draw_sin(canvas, ctx, shift + 1); }, 10);
}

var canvas = document.getElementById("myCanvas");
console.log(`canvas width ${canvas.width} height ${canvas.height}`);
var ctx = canvas.getContext("2d");

cmd = http_get_params()['cmd']
if (!cmd) {
  cmd = "circle"; // default
}
console.log(`cmd is ${cmd}`);

if (cmd == "circle") {
  draw_circle_demo(canvas, ctx);
} else if (cmd == "rect_demo") {
  draw_rect_demo(ctx);
} else {
  draw_sin(canvas, ctx)
}

</script>
</body>
</html>
